1085 PAT单位排行 (25 分)
每次 PAT 考试结束后，考试中心都会发布一个考生单位排行榜。本题就请你实现这个功能。
### 输入格式：
输入第一行给出一个正整数 N（≤$10^5$），即考生人数。随后 N 行，每行按下列格式给出一个考生的信息：
```
准考证号 得分 学校
```
其中<font color="red" size="2px">准考证号是由 6 个字符组成的字符串，其首字母表示考试的级别：<font color="red" size="2px">B代表乙级，<font color="red" size="2px">A代表甲级，<font color="red" size="2px">T代表顶级；<font color="red" size="2px">得分是 [0, 100] 区间内的整数；<font color="red" size="2px">学校是由不超过 6 个英文字母组成的单位码（大小写无关）。注意：题目保证每个考生的准考证号是不同的。
### 输出格式：
首先在一行中输出单位个数。随后按以下格式非降序输出单位的排行榜：
```
排名 学校 加权总分 考生人数
```
其中<font color="red" size="2px">排名是该单位的排名（从 1 开始）；<font color="red" size="2px">学校是全部按小写字母输出的单位码；<font color="red" size="2px">加权总分定义为<font color="red" size="2px">乙级总分/1.5 + 甲级总分 + 顶级总分*1.5的整数部分；<font color="red" size="2px">考生人数是该属于单位的考生的总人数。
学校首先按加权总分排行。如有并列，则应对应相同的排名，并按考生人数升序输出。如果仍然并列，则按单位码的字典序输出。
### 输入样例：
```
10
A57908 85 Au
B57908 54 LanX
A37487 60 au
T28374 67 CMU
T32486 24 hypu
A66734 92 cmu
B76378 71 AU
A47780 45 lanx
A72809 100 pku
A03274 45 hypu
```
### 输出样例：
```
5
1 cmu 192 2
1 au 192 3
3 pku 100 1
4 hypu 81 2
4 lanx 81 2
```
### 代码如下：
```c
#include<stdio.h>
#include<string.h>
#include<stdlib.h>
#include<ctype.h>

/*定义学生结构体类型 */
typedef struct {
    char id[7];
    int score;
    char school[7];
}Student;

/*定义学校结构体类型 */
typedef struct {
    char name[7];
    int score;
    int num;
}School;

/*按校名的字典序排序 */
int cmp_school(const void * a, const void * b){
    return strcmp((*(Student**)a)->school, (*(Student**)b)->school);
}

/*按分数，学校参加人数，校名字典序非降序排序 */
int cmp_sort_all(const void * a, const void * b){
    School *s1 = *(School**)a, *s2 = *(School**)b;
    if(s1->score - s2->score) return s2->score - s1->score;
    else if(s1->num - s2->num) return s1->num - s2->num;
    else return strcmp(s1->name, s2->name);
}

int main(){
    int n, m = 0, num = 0;
    double total_score = 0;
    Student students[100001] = {0}, *stu[100001] = {0};
    School schools[100001] = {0}, *sch[100001] = {0};
    
    /*读入数组*/
    scanf("%d", &n);
    for(int i = 0; i < n; i++){
        /*stu指针指向数组*/
        stu[i] = students + i;
        scanf("%s %d %s", stu[i]->id, &stu[i]->score, stu[i]->school);
        for(char *s = stu[i]->school; *s; s++){
            *s = tolower(*s); //将学校名称合部转换成小写 
        } 
    } 
    
    /*以单位码的字典序排序*/ 
    qsort(stu, n, sizeof(Student*), cmp_school);
    
    /*计算总分和记录学校信息*/ 
    for(Student **p = stu; p < stu + n; p++){
        /*计算总分*/ 
        switch((*p)->id[0]){
            case 'B': total_score += (*p)->score / 1.5; break;
            case 'A': total_score += (*p)->score; break;
            case 'T': total_score += (*p)->score * 1.5;break;
        }
        num++;
        /*如果学校名字不一样，则将校名,学校的总分数，以及学校参加人数保存 */
        if(!*(p + 1) || strcmp((*p)->school,(*(p + 1))->school)){
            sch[m] = schools + m;
            strcpy(sch[m]->name, (*p)->school);
            sch[m]->score = (int)total_score;
            sch[m]->num = num;
            total_score = 0, num = 0; m++;
        }
    } 
    
    //根据题意要求排序 
    qsort(sch, m, sizeof(School*), cmp_sort_all);
    
    //输出学结果 
    printf("%d\n", m);
    for(int i = 0, ranking = 0; i < m; i++){
        if(i > 0 && sch[i]->score < sch[i - 1]->score) ranking = i;
        printf("%d %s %d %d\n", ranking + 1, sch[i]->name, sch[i]->score,sch[i]->num);
    }
    
    return 0;
} 
```